!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.xstate=e():t.xstate=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";function r(t){try{return"string"==typeof t||"number"==typeof t?""+t:t.type}catch(t){throw new Error("Events must be strings or objects with a string event.type property.")}}function i(t){try{return"string"==typeof t||"number"==typeof t?""+t:"function"==typeof t?t.name:t.type}catch(t){throw new Error("Events must be strings or objects with a string event.type property.")}}function a(t,e){try{return Array.isArray(t)?t:t.toString().split(e)}catch(e){throw new Error("'"+t+"' is not a valid state path.")}}function o(t,e){return t instanceof d?t.value:"object"!=typeof t||t instanceof d?s(a(t,e)):t}function s(t){if(1===t.length)return t[0];for(var e={},n=e,r=0;r<t.length-1;r++)r===t.length-2?n[t[r]]=t[r+1]:(n[t[r]]={},n=n[t[r]]);return e}function u(t,e){var n={};return Object.keys(t).forEach(function(r){n[r]=e(t[r],r,t)}),n}function c(t,e,n){var r={};return Object.keys(t).forEach(function(i){var a=t[i];n(a)&&(r[i]=e(a,i,t))}),r}function h(t,e,n){void 0===n&&(n=l);var r=o(t,n),i=o(e,n);return"string"==typeof i?"string"==typeof r&&i===r:"string"==typeof r?r in i:Object.keys(r).every(function(t){return t in i&&h(r[t],i[t])})}function f(t,e){var n;return Object.keys(t).forEach(function(t){h(t,e)&&(!n||e.length>n.length)&&(n=t)}),t[n]}function p(t,e){return new C(t,e)}Object.defineProperty(e,"__esModule",{value:!0});var y={};n.d(y,"actionTypes",function(){return b}),n.d(y,"toEventObject",function(){return w}),n.d(y,"toActionObject",function(){return j}),n.d(y,"toActionObjects",function(){return O}),n.d(y,"raise",function(){return _}),n.d(y,"send",function(){return N}),n.d(y,"cancel",function(){return k}),n.d(y,"start",function(){return A}),n.d(y,"stop",function(){return P});var l=".",v={},d=function(){function t(t,e,n,r,i,a){void 0===n&&(n=[]),void 0===r&&(r=v),void 0===i&&(i={}),void 0===a&&(a=[]),this.value=t,this.history=e,this.actions=n,this.activities=r,this.data=i,this.events=a}return t.from=function(e){return e instanceof t?e:new t(e)},t.inert=function(e){return e instanceof t?e.actions.length?new t(e.value,e.history,[],e.activities):e:t.from(e)},t.prototype.toString=function(){if("string"==typeof this.value)return this.value;for(var t=[],e=this.value;;){if("string"==typeof e){t.push(e);break}var n=Object.keys(e),r=n[0];if(n.slice(1).length)return;t.push(r),e=e[r]}return t.join(l)},t}(),g=function(t){return function(e){for(var n=e,r=0,i=t;r<i.length;r++){n=n[i[r]]}return n}},m=function(t){return"string"==typeof t?[[t]]:x(Object.keys(t).map(function(e){return m(t[e]).map(function(t){return[e].concat(t)})}))},S=function(t){var e={};if(t&&1===t.length&&1===t[0].length)return t[0][0];for(var n=0,r=t;n<r.length;n++)for(var i=r[n],a=e,o=0;o<i.length;o++){var s=i[o];if(o===i.length-2){a[s]=i[o+1];break}a[s]=a[s]||{},a=a[s]}return e},x=function(t){return t.reduce(function(t,e){return t.concat(e)},[])},b={start:"xstate.start",stop:"xstate.stop",raise:"xstate.raise",send:"xstate.send",cancel:"xstate.cancel",null:"xstate.null"},E=function(t){return function(e){var n="string"==typeof e||"number"==typeof e?{type:e}:e;return{type:t,activity:r(e),data:n}}},w=function(t){return"string"==typeof t||"number"==typeof t?{type:t}:t},j=function(t){var e;if("string"==typeof t||"number"==typeof t)e={type:t};else{if("function"!=typeof t)return t;e={type:t.name}}return Object.defineProperty(e,"toString",{value:function(){return e.type}}),e},O=function(t){return t?(Array.isArray(t)?t:[t]).map(j):[]},_=function(t){return{type:b.raise,event:t}},N=function(t,e){return{type:b.send,event:w(t),delay:e?e.delay:void 0,id:e&&void 0!==e.id?e.id:r(t)}},k=function(t){return{type:b.cancel,sendId:t}},A=E(b.start),P=E(b.stop),R=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},V=".",M="",F=function(t){return"#"===t[0]},T={guards:{}},C=function(){function t(e,n){void 0===n&&(n=T);var r=this;this.config=e,this.options=n,this.__cache={events:void 0,relativeValue:new Map,initialState:void 0},this.idMap={},this.key=e.key||"(machine)",this.parent=e.parent,this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=e.delimiter||(this.parent?this.parent.delimiter:V),this.id=e.id||(this.machine?[this.machine.key].concat(this.path).join(this.delimiter):this.key),this.initial=e.initial,this.parallel=!!e.parallel,this.states=e.states?u(e.states,function(e,n){var i=new t(R({},e,{key:n,parent:r}));return Object.assign(r.idMap,R((a={},a[i.id]=i,a),i.idMap)),i;var a}):{},this.history=!0===e.history?"shallow":e.history||!1,this.on=e.on?this.formatTransitions(e.on):{},this.transient=!!this.on[M],this.strict=!!e.strict,this.onEntry=e.onEntry?[].concat(e.onEntry):[],this.onExit=e.onExit?[].concat(e.onExit):[],this.data=e.data,this.activities=e.activities}return t.prototype.getStateNodes=function(t){var e=this;if(!t)return[];var n=t instanceof d?t.value:o(t,this.delimiter);if("string"==typeof n){var r=this.getStateNode(n).initial;return r?this.getStateNodes((a={},a[n]=r,a)):[this.states[n]]}var i=Object.keys(n);return i.map(function(t){return e.getStateNode(t)}).concat(i.reduce(function(t,r){var i=e.getStateNode(r).getStateNodes(n[r]);return t.concat(i)},[]));var a},t.prototype.handles=function(t){var e=r(t);return-1!==this.events.indexOf(e)},t.prototype._transitionLeafNode=function(t,e,n,r){var i=this.getStateNode(t),a=i._next(e,n,r);if(!a.value){var o=this._next(e,n,r),s=o.value,u=o.entryExitStates,c=o.actions,h=o.paths;return{value:s,entryExitStates:{entry:u?u.entry:new Set,exit:new Set([i].concat(u?Array.from(u.exit):[]))},actions:c,paths:h}}return a},t.prototype._transitionHierarchicalNode=function(t,e,n,r){var i=Object.keys(t),a=this.getStateNode(i[0]),o=a._transition(t[i[0]],e,n,r);if(!o.value){var s=this._next(e,n,r),u=s.value,c=s.entryExitStates,h=s.actions,f=s.paths;return{value:u,entryExitStates:{entry:c?c.entry:new Set,exit:new Set((o.entryExitStates?Array.from(o.entryExitStates.exit):[]).concat([a],c?Array.from(c.exit):[]))},actions:h,paths:f}}return o},t.prototype._transitionOrthogonalNode=function(t,e,n,r){var i=this,a=[],o={};if(Object.keys(t).forEach(function(s){var u=t[s];if(u){var c=i.getStateNode(s)._transition(u,e,n,r);c.value||a.push(s),o[s]=c}}),!Object.keys(o).some(function(t){return void 0!==o[t].value})){var u=this._next(e,n,r),c=u.value,f=u.entryExitStates,p=u.actions,y=u.paths;return{value:c,entryExitStates:{entry:f?f.entry:new Set,exit:new Set(Object.keys(this.states).map(function(t){return i.states[t]}).concat(f?Array.from(f.exit):[]))},actions:p,paths:y}}var l=x(Object.keys(o).map(function(t){return o[t].paths}));if(1===l.length&&!h(s(this.path),s(l[0])))return{value:this.machine.resolve(S(l)),entryExitStates:Object.keys(o).map(function(t){return o[t].entryExitStates}).reduce(function(t,e){var n=e,r=n.entry,i=n.exit;return{entry:new Set(Array.from(t.entry).concat(Array.from(r))),exit:new Set(Array.from(t.exit).concat(Array.from(i)))}},{entry:new Set,exit:new Set}),actions:x(Object.keys(o).map(function(t){return o[t].actions})),paths:l};var v=x(Object.keys(o).map(function(t){var n=o[t];return n.value?n.paths:m(g(i.path)(e.value)[t]).map(function(e){return i.path.concat(t,e)})})),d=this.machine.resolve(S(v));return{value:d,entryExitStates:Object.keys(o).reduce(function(t,e){var n=o[e],r=n.value,i=n.entryExitStates;if(!r||!i)return t;var a=i.entry,s=i.exit;return{entry:new Set(Array.from(t.entry).concat(Array.from(a))),exit:new Set(Array.from(t.exit).concat(Array.from(s)))}},{entry:new Set,exit:new Set}),actions:x(Object.keys(o).map(function(t){return o[t].actions})),paths:m(d)}},t.prototype._transition=function(t,e,n,r){return"string"==typeof t?this._transitionLeafNode(t,e,n,r):1===Object.keys(t).length?this._transitionHierarchicalNode(t,e,n,r):this._transitionOrthogonalNode(t,e,n,r)},t.prototype._next=function(t,e,n){var i=this,a=r(e),s=this.on[a],u=this.transient?[{type:b.null}]:[];if(!s||!s.length)return{value:void 0,entryExitStates:void 0,actions:u,paths:[]};for(var c,f=[],p=0,y=s;p<y.length;p++){var l=y[p],v=l,d=v.cond,m=v.in,E=n||{},j=w(e),O=!m||h(o(m,this.delimiter),g(this.path.slice(0,-2))(t.value));if((!d||this._evaluateCond(d,E,j,t.value))&&(!m||O)){f=Array.isArray(l.target)?l.target:[l.target],u.push.apply(u,l.actions?l.actions:[]),c=l;break}}if(0===f.length)return{value:void 0,entryExitStates:void 0,actions:u,paths:[]};var _=x(f.map(function(e){return i.getRelativeStateNodes(e,t.history)})),N=_.map(function(t){return t.path}),k=_.reduce(function(t,e){var n=i._getEntryExitStates(e,!!c.internal),r=n.entry,a=n.exit;return{entry:new Set(Array.from(t.entry).concat(Array.from(r))),exit:new Set(Array.from(t.exit).concat(Array.from(a)))}},{entry:new Set,exit:new Set});return{value:this.machine.resolve(S(x(f.map(function(e){return i.getRelativeStateNodes(e,t.history).map(function(t){return t.path})})))),entryExitStates:k,actions:u,paths:N}},t.prototype._getEntryExitStates=function(t,e){for(var n={entry:[],exit:[]},r=this.path,i=t.path,a=this.machine,o=0;o<Math.min(r.length,i.length);o++){var s=r[o];if(s!==i[o])break;a=a.getStateNode(s)}for(var u=a.path,c=a,h=0,f=r.slice(u.length);h<f.length;h++){var p=f[h];c=c.getStateNode(p),n.exit.unshift(c)}a===this&&(e||(n.exit.push(this),n.entry.push(this))),c=a;for(var y=0,l=i.slice(u.length);y<l.length;y++){var p=l[y];c=c.getStateNode(p),n.entry.push(c)}return{entry:new Set(n.entry),exit:new Set(n.exit)}},t.prototype._evaluateCond=function(t,e,n,r){var i;if("string"==typeof t){if(!this.machine.options.guards[t])throw new Error("String condition '"+t+"' is not defined on machine '"+this.machine.id+"'");i=this.machine.options.guards[t]}else i=t;return i(e,n,r)},t.prototype._getActions=function(t){var e={entry:t.entryExitStates?x(Array.from(t.entryExitStates.entry).map(function(t){return t.onEntry.concat(t.activities?t.activities.map(function(t){return A(t)}):[])})):[],exit:t.entryExitStates?x(Array.from(t.entryExitStates.exit).map(function(t){return t.onExit.concat(t.activities?t.activities.map(function(t){return P(t)}):[])})):[]};return(e.exit||[]).concat(t.actions||[]).concat(e.entry||[])},t.prototype._getActivities=function(t,e){if(!e.entryExitStates)return{};var n=R({},t.activities);return Array.from(e.entryExitStates.entry).forEach(function(t){t.activities&&t.activities.forEach(function(t){n[i(t)]=!0})}),Array.from(e.entryExitStates.exit).forEach(function(t){t.activities&&t.activities.forEach(function(t){n[i(t)]=!1})}),n},t.prototype.transition=function(t,e,n){var i="string"==typeof t?this.resolve(s(this.getResolvedPath(t))):t instanceof d?t:this.resolve(t),a=r(e);if(this.strict&&-1===this.events.indexOf(a))throw new Error("Machine '"+this.id+"' does not accept event '"+a+"'");var o=d.from(i),u=this._transition(o.value,o,e,n);try{this.ensureValidPaths(u.paths)}catch(t){throw new Error("Event '"+a+"' leads to an invalid configuration: "+t.message)}var c=this._getActions(u),h=this._getActivities(o,u),f=c.filter(function(t){return"object"==typeof t&&(t.type===b.raise||t.type===b.null)}),p=c.filter(function(t){return"object"!=typeof t||t.type!==b.raise&&t.type!==b.null}),y=u.value?this.getStateNodes(u.value):[];y.some(function(t){return t.transient})&&f.push({type:b.null});var l={};y.forEach(function(t){l[t.id]=t.data}),delete o.history;var v=u.value?new d(u.value,o,p,h,l,f):void 0;if(!v)return d.inert(o);for(var g=v;f.length;){var m=g.actions,S=f.shift();g=this.transition(g,S.type===b.null?M:S.event,n),(x=g.actions).unshift.apply(x,m)}return g;var x},t.prototype.ensureValidPaths=function(t){var e=this,n=new Map,r=x(t.map(function(t){return e.getRelativeStateNodes(t)}));t:for(var i=0,a=r;i<a.length;i++)for(var o=a[i],s=o;s.parent;){if(n.has(s.parent)){if(s.parent.parallel)continue t;throw new Error("State node '"+o.id+"' shares parent '"+s.parent.id+"' with state node '"+n.get(s.parent).map(function(t){return t.id})+"'")}n.get(s.parent)?n.get(s.parent).push(o):n.set(s.parent,[o]),s=s.parent}},t.prototype.getStateNode=function(t){if(F(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '"+t+"' from '"+this.id+"'; no child states exist.");var e=this.states[t];if(!e)throw new Error("Child state '"+t+"' does not exist on '"+this.id+"'");return e},t.prototype.getStateNodeById=function(t){var e=F(t)?t.slice("#".length):t,n=this.machine.idMap[e];if(!n)throw new Error("Substate '#"+e+"' does not exist on '"+this.id+"'");return n},t.prototype.resolve=function(t){var e=this;if("string"==typeof t){var n=this.getStateNode(t);return n.initial?(r={},r[t]=n.initialStateValue,r):t}return this.parallel?u(this.initialStateValue,function(n,r){return n?e.getStateNode(r).resolve(t[r]||n):{}}):u(t,function(t,n){return t?e.getStateNode(n).resolve(t):{}});var r},Object.defineProperty(t.prototype,"resolvedStateValue",{get:function(){var t=this.key;return this.parallel?(e={},e[t]=c(this.states,function(t){return t.resolvedStateValue[t.key]},function(t){return!t.history}),e):this.initial?(n={},n[t]=this.states[this.initial].resolvedStateValue,n):t;var e,n},enumerable:!0,configurable:!0}),t.prototype.getResolvedPath=function(t){if(F(t)){var e=this.machine.idMap[t.slice("#".length)];if(!e)throw new Error("Unable to find state node '"+t+"'");return e.path}return a(t,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){if(this.__cache.initialState)return this.__cache.initialState;var t=this.parallel?c(this.states,function(t){return t.initialStateValue||{}},function(t){return!t.history}):"string"==typeof this.resolvedStateValue?void 0:this.resolvedStateValue[this.key];return this.__cache.initialState=t,this.__cache.initialState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '"+this.id+".'");var e={},n=[];return this.getStateNodes(t).forEach(function(t){t.onEntry&&n.push.apply(n,t.onEntry),t.activities&&t.activities.forEach(function(t){e[r(t)]=!0,n.push(A(t))})}),new d(t,void 0,n,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var t;if(this.history){var e=this.config;t=e.target&&"string"==typeof e.target&&F(e.target)?s(this.machine.getStateNodeById(e.target).path.slice(this.path.length-1)):e.target}return t},enumerable:!0,configurable:!0}),t.prototype.getStates=function(t){var e=this;if("string"==typeof t)return[this.states[t]];var n=[];return Object.keys(t).forEach(function(r){n.push.apply(n,e.states[r].getStates(t[r]))}),n},t.prototype.getRelativeStateNodes=function(t,e,n){void 0===n&&(n=!0);var r=e?e.value:void 0;if("string"==typeof t&&F(t)){var i=this.getStateNodeById(t);return n?i.history?i.resolveHistory(r):i.initialStateNodes:[i]}var o=a(t,this.delimiter),s=this.parent||this,u=s.getFromRelativePath(o,r);return n?x(u.map(function(t){return t.initialStateNodes})):u},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var t=this;if(!this.parallel&&!this.initial)return[this];var e=this.initialState,n=m(e.value);return x(n.map(function(e){return t.getFromRelativePath(e)}))},enumerable:!0,configurable:!0}),t.prototype.getFromRelativePath=function(t,e){var n=this;if(!t.length)return[this];var r=t[0],i=t.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '"+r+"' from node with no states");if("$history"===r){if(!e)return[this];var a=g(this.path)(e);return"string"==typeof a?this.states[a].getFromRelativePath(i,e):x(Object.keys(a).map(function(t){return n.states[t].getFromRelativePath(i,e)}))}var o=this.getStateNode(r);if(o.history)return o.resolveHistory(e);if(!this.states[r])throw new Error("Child state '"+r+"' does not exist on '"+this.id+"'");return this.states[r].getFromRelativePath(i,e)},t.prototype.resolveHistory=function(t){var e=this;if(!this.history)return[this];var n=this.parent;if(t){var r=g(n.path)(t);return"string"==typeof r?[n.getStateNode(r)]:x(m(r).map(function(t){return"deep"===e.history?n.getFromRelativePath(t):[n.states[t[0]]]}))}return this.target?x(m(this.target).map(function(e){return n.getFromRelativePath(e,t)})):this.parent.initialStateNodes},Object.defineProperty(t.prototype,"events",{get:function(){if(this.__cache.events)return this.__cache.events;var t=this.states,e=new Set(Object.keys(this.on));return t&&Object.keys(t).forEach(function(n){var r=t[n];if(r.states)for(var i=0,a=r.events;i<a.length;i++){var o=a[i];e.add(""+o)}}),this.__cache.events=Array.from(e)},enumerable:!0,configurable:!0}),t.prototype.formatTransition=function(t,e){var n=this,r=!!e&&e.internal,i=t.map(function(t){var e="string"==typeof t&&t[0]===n.delimiter;return r=r||e,e&&!n.parent?t.slice(1):e?n.key+t:t});return R({},e,{target:i,internal:r})},t.prototype.formatTransitions=function(t){var e=this;return u(t,function(t){return void 0===t?[]:Array.isArray(t)?t.map(function(t){return e.formatTransition([].concat(t.target),t)}):"string"==typeof t?[e.formatTransition([t])]:Object.keys(t).map(function(n){return e.formatTransition([n],t[n])})})},t}();n.d(e,"Machine",function(){return p}),n.d(e,"StateNode",function(){return C}),n.d(e,"State",function(){return d}),n.d(e,"matchesState",function(){return h}),n.d(e,"mapState",function(){return f}),n.d(e,"actions",function(){return y})}])});